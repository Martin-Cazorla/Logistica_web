<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Logística E-commerce</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script> 
</head>
<body class="index-body">   <header class="header-principal">
        <h1>Panel de Carga Diaria - Envíos</h1>
        <button id="btn-logout" class="btn-logout-top">CERRAR SESIÓN</button>
    </header>

    <div class="resumen-container">
        <div class="kpi-card">
            <span class="kpi-label">UNIDADES PRESENTES</span>
            <span id="contador-unidades" class="kpi-value">0</span>
        </div>     
        <div class="kpi-card">
            <span class="kpi-label">TOTAL EXTRAS</span>
            <span id="contador-extras" class="kpi-value">0</span>
        </div>
        <div class="acciones-botones">
            <a href="pages/historial.html" class="btn-historial">VER HISTORIAL</a>
            <button class="btn-excel" id="btn-exportar">DESCARGAR EXCEL</button>
            <button class="btn-limpiar" id="btn-archivar">ARCHIVAR Y LIMPIAR</button> 
        </div>
    </div>

    <table class="tabla-logistica">
        <thead>
            <tr>
                <th>Fecha</th>
                <th>Horario</th>
                <th>Unidad (ID)</th>
                <th>Modelo</th>
                <th>Tamaño</th>
                <th>Chofer</th>
                <th>Vueltas</th> 
                <th>Extra</th>   
                <th>Observaciones</th> 
                <th>Acción</th>
            </tr>
        </thead>
        <tbody id="tabla-body">
        </tbody>
    </table>

    <script type="module">    
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBa1n9yQJ33viJ_3P-99yuL4-fzQFzLPIs",
            authDomain: "logistica-envios-44bf6.firebaseapp.com",
            projectId: "logistica-envios-44bf6",
            storageBucket: "logistica-envios-44bf6.firebasestorage.app",
            messagingSenderId: "611013572218",
            appId: "1:611013572218:web:beb687be674a65ceafadc3",
            measurementId: "G-V14SKXYCJ5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        window.db = db;
        window.firestoreLib = { collection, addDoc, getDocs, query, orderBy, deleteDoc, doc };

        onAuthStateChanged(auth, (user) => {
            if (!user) { 
                window.location.href = "login.html"; 
            } else {
                import('./script.js').then(() => {
                   console.log("Sistema de carga continua activado");
                }).catch(err => console.error("Error cargando script.js:", err));
            }
        });

        document.getElementById('btn-logout').onclick = async () => {
            await signOut(auth);
            window.location.href = "login.html";
        };
    </script>   
</body>
</html>