<!DOCTYPE html>
<html lang="es">
<head>   
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historial de Logística - E-commerce</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>  
<body class="historial-body">

    <h1>HISTORIAL DE CARGAS ARCHIVADAS</h1>

    <div class="resumen-container">
        <div class="filtros-container">
            <div class="filtro-grupo">
                <label>Buscar por Fecha:</label>
                <input type="date" id="filtro-fecha">
            </div>
            <div class="filtro-grupo">
                <label>Buscar por Unidad:</label>
                <input type="text" id="filtro-unidad" placeholder="Ej: 28">
            </div>
        </div>

        <div class="kpi-card">
            <span class="kpi-label">REGISTROS FILTRADOS</span>
            <span id="total-registros" class="kpi-value">0</span>
        </div>

        <div class="acciones-botones">
            <a href="../pages/indicadores.html" class="btn-excel" style="text-decoration: none; background-color: #007bff;">VER INDICADORES</a>
            <a href="../index.html" class="btn-historial" style="text-decoration: none;">VOLVER AL PANEL</a>
            <button class="btn-excel" id="btn-limpiar-filtros" style="background-color: #6c757d;">LIMPIAR FILTROS</button>
            <button class="btn-excel" id="btn-descargar-excel">DESCARGAR EXCEL</button>
            <button class="btn-limpiar" id="btn-borrar-todo">BORRAR TODO</button>
        </div>
    </div>

    <table class="tabla-logistica">
        <thead>
            <tr>
                <th>FECHA</th>
                <th>HORARIO</th>
                <th>UNIDAD</th>
                <th>CHOFER</th>
                <th>VUELTAS</th>
                <th>EXTRA</th>
                <th>OBSERVACIONES</th>
                <th>ACCIONES</th>
            </tr>
        </thead>
        <tbody id="tabla-historial-body"></tbody>
    </table>

    <div id="modalEditar" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h3>Editar Registro</h3></div>
            <div class="modal-body">
                <input type="hidden" id="edit-id">
                <div class="form-group"><label>Fecha:</label><input type="text" id="edit-fecha"></div>
                <div class="form-group">
                    <label>Horario:</label>
                    <select id="edit-horario">
                        <option value="10:00hs">10:00hs</option>
                        <option value="11:00hs">11:00hs</option>
                        <option value="Electro">Electro</option>
                        <option value="Agregado">Agregado</option>
                        <option value="No se presenta">No se presenta</option>
                    </select>
                </div>
                <div class="form-group"><label>Unidad:</label><input type="text" id="edit-unidad"></div>
                <div class="form-group">
                    <label>Vueltas:</label>
                    <select id="edit-vueltas">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Extra:</label>
                    <select id="edit-extra">
                        <option value="0">0</option>
                        <option value="1">1</option>
                    </select>
                </div>
                <div class="form-group"><label>Observaciones:</label><input type="text" id="edit-obs"></div>
            </div>   
            <div class="modal-footer">
                <button class="btn-cancelar" id="btn-cerrar-modal">Cancelar</button>
                <button class="btn-guardar" id="btn-guardar-modal">Guardar Cambios</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, deleteDoc, doc, updateDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBa1n9yQJ33viJ_3P-99yuL4-fzQFzLPIs", 
            authDomain: "logistica-envios-44bf6.firebaseapp.com",
            projectId: "logistica-envios-44bf6",
            storageBucket: "logistica-envios-44bf6.firebasestorage.app",
            messagingSenderId: "611013572218",
            appId: "1:611013572218:web:beb687be674a65ceafadc3",
            measurementId: "G-V14SKXYCJ5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Bloque de seguridad y carga de datos
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("Sesión activa:", user.email);
                window.db = db;
                window.firestoreLib = { collection, getDocs, deleteDoc, doc, updateDoc, query, orderBy };
                      
                if (typeof window.cargarHistorialDesdeFirebase === "function") {
                    window.cargarHistorialDesdeFirebase();
                }
            } else {
                window.location.href = "../login.html";
            }
        });
    </script>

    <script src="../config.js"></script>
    <script type="module" src="../historial.js"></script>
</body>
</html>