<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indicadores de Rendimiento</title>
    <link rel="stylesheet" href="../css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <h1>DASHBOARD DE RENDIMIENTO</h1>

    <div class="resumen-container">
        <div class="filtro-grupo-dashboard">
            <label>FILTRAR POR D√çA:</label>
            <input type="date" id="filtro-fecha-dashboard" class="input-calendario">
            <button class="btn-excel" id="btn-aplicar-filtro">FILTRAR</button>
            <button class="btn-historial" id="btn-quitar-filtro">VER TODO</button>
        </div>
    </div>

    <div class="resumen-container">
        <div class="kpi-card border-blue">
            <span class="kpi-label">UNIDADES EN PERIODO</span>
            <span id="kpi-unidades" class="kpi-value">0</span>
        </div>

        <div class="kpi-card border-green">
            <span class="kpi-label">PRODUCTIVIDAD x UNIDAD</span>
            <span id="kpi-productividad" class="kpi-value">0.00</span>
        </div>
        
        <div class="kpi-card border-yellow">
            <span class="kpi-label">RATIO DE EXTRAS</span>
            <span id="kpi-extras" class="kpi-value">0%</span>
        </div>

        <div class="acciones-botones">
            <a href="../index.html" class="btn-historial" style="text-decoration: none;">VOLVER AL PANEL</a>
        </div>
    </div>

    <div class="resumen-container dashboard-grafico">
        <canvas id="graficoVueltas" width="400" height="150"></canvas>
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBa1n9yQJ33viJ_3P-99yuL4-fzQFzLPIs", // Corregida
            authDomain: "logistica-envios-44bf6.firebaseapp.com",
            projectId: "logistica-envios-44bf6",
            storageBucket: "logistica-envios-44bf6.firebasestorage.app",
            messagingSenderId: "611013572218",
            appId: "1:611013572218:web:beb687be674a65ceafadc3",
            measurementId: "G-V14SKXYCJ5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                window.db = db;
                window.firestoreLib = { collection, getDocs, query };
                
                if (typeof window.obtenerDatos === "function") {
                    window.obtenerDatos();
                }
            } else {
                window.location.href = "../login.html";
            }
        });
    </script>

    <script src="../config.js"></script>
    <script type="module" src="../indicadores.js"></script>
</body>
</html>